# 工资明细导出脚本使用说明

## 功能描述
该脚本用于导出指定薪资周期的完整工资明细信息到CSV文件，包含所有收入项目、扣除项目、员工基本信息等120+个详细字段。

## 安装依赖
```bash
pip install psycopg2-binary
```

## 使用方法

### 1. 基本用法
```bash
# 导出2025年6月的工资明细（自动过滤零值字段）
python export_payroll_details.py 2025-06
```

### 2. 导出所有字段
```bash
# 包含所有字段，不过滤零值项目
python export_payroll_details.py 2025-06 --include-zero-fields
```

### 3. 指定输出文件
```bash
# 自定义输出文件名
python export_payroll_details.py 2025-06 --output 工资明细_202506.csv
```

### 4. 仅查看统计信息
```bash
# 只显示统计信息，不导出文件
python export_payroll_details.py 2025-06 --stats-only
```

### 5. 分析字段结构
```bash
# 分析工资字段结构和分布
python export_payroll_details.py 2025-06 --analyze-fields
```

### 6. 查看帮助
```bash
python export_payroll_details.py --help
```

## 输出文件字段分类

### 基本信息字段 (16个)
| 字段名 | 描述 |
|--------|------|
| 薪资条目ID | 薪资记录唯一标识 |
| 员工ID | 员工唯一标识 |
| 薪资期间ID | 薪资周期标识 |
| 薪资运行ID | 薪资运行批次标识 |
| 员工编号 | 员工工号 |
| 姓名 | 员工完整姓名 |
| 身份证号 | 员工身份证号码 |
| 电话 | 联系电话 |
| 邮箱 | 电子邮箱地址 |
| 入职日期 | 员工入职时间 |
| 员工状态 | 在职/离职状态 |
| 部门名称 | 所属部门 |
| 职位名称 | 职位名称 |
| 人员类别 | 身份类别（公务员、事业管理人员等） |
| 根人员类别 | 根级人员分类 |
| 薪资期间名称 | 薪资发放周期名称 |

### 收入项目字段 (50+个)

#### 基础工资类
| 字段名 | 描述 |
|--------|------|
| 基本工资 | 员工基本工资标准 |
| 岗位工资 | 岗位工资 |
| 级别工资 | 级别工资 |
| 薪级工资 | 薪级工资标准 |
| 职务/技术等级工资 | 职务技术等级工资 |
| 级别/岗位级别工资 | 级别岗位工资 |
| 事业单位人员薪级工资 | 事业单位薪级工资 |

#### 绩效奖金类
| 字段名 | 描述 |
|--------|------|
| 绩效工资 | 绩效工资 |
| 奖励性绩效工资 | 奖励性绩效工资 |
| 基础性绩效工资 | 基础性绩效工资 |
| 月奖励绩效 | 月度奖励绩效 |
| 基础绩效奖 | 基础绩效奖金 |
| 月基础绩效 | 月度基础绩效 |
| 季度绩效考核薪酬 | 季度绩效考核薪酬 |
| 1季度绩效考核薪酬 | 第一季度绩效考核 |
| 年度考核奖 | 年度考核奖金 |
| 绩效奖 | 绩效奖金 |

#### 津贴补贴类
| 字段名 | 描述 |
|--------|------|
| 津贴 | 各类津贴 |
| 补助 | 各类补助 |
| 岗位职务补贴 | 岗位职务补贴 |
| 住房补贴 | 住房补贴 |
| 公务交通补贴 | 公务交通补贴 |
| 乡镇工作补贴 | 乡镇工作补贴 |
| 艰苦边远地区津贴 | 边远地区津贴 |
| 公检法艰苦边远地区津贴 | 公检法边远地区津贴 |

#### 专业津贴类
| 字段名 | 描述 |
|--------|------|
| 教龄津贴 | 教龄津贴 |
| 护龄津贴 | 护龄津贴 |
| 警衔津贴 | 警衔津贴 |
| 特级教师津贴 | 特级教师津贴 |
| 特殊岗位津贴 | 特殊岗位津贴 |

#### 公安类津贴
| 字段名 | 描述 |
|--------|------|
| 人民警察值勤岗位津贴 | 警察值勤津贴 |
| 人民警察加班补贴 | 警察加班补贴 |
| 公安岗位津贴 | 公安岗位津贴 |
| 公安执勤津贴 | 公安执勤津贴 |
| 公安法定工作日之外加班补贴 | 公安加班补贴 |

#### 改革保留类
| 字段名 | 描述 |
|--------|------|
| 九三年工改保留津补贴 | 93年工改保留补贴 |
| 公务员规范后津补贴 | 公务员规范津补贴 |
| 法院检察院工改保留津贴 | 法检工改保留津贴 |
| 法院检察院规范津补贴 | 法检规范津补贴 |
| 纪委监委机构改革保留补贴 | 纪委改革保留补贴 |

### 扣除项目字段 (15+个)

#### 个人缴费类
| 字段名 | 描述 |
|--------|------|
| 个人所得税 | 个人所得税 |
| 养老保险个人应缴金额 | 个人养老保险 |
| 医疗保险个人缴纳金额 | 个人医疗保险 |
| 失业保险个人应缴金额 | 个人失业保险 |
| 职业年金个人应缴费额 | 个人职业年金 |
| 个人缴住房公积金 | 个人公积金 |

#### 单位缴费类（信息项目）
| 字段名 | 描述 |
|--------|------|
| 养老保险单位应缴金额 | 单位养老保险 |
| 医疗保险单位缴纳金额 | 单位医疗保险 |
| 失业保险单位应缴金额 | 单位失业保险 |
| 工伤单位应缴金额 | 单位工伤保险 |
| 职业年金单位应缴费额 | 单位职业年金 |
| 单位缴住房公积金 | 单位公积金 |

#### 补扣调整类
| 字段名 | 描述 |
|--------|------|
| 一次性补扣发 | 一次性补扣发 |
| 奖励绩效补扣发 | 奖励绩效补扣发 |
| 绩效奖金补扣发 | 绩效奖金补扣发 |
| 补扣社保 | 补扣社保 |
| 补扣（退）款 | 补扣退款 |

### 汇总字段 (5个)
| 字段名 | 描述 |
|--------|------|
| 应发合计 | 应发工资总额 |
| 扣除合计 | 扣除金额总计 |
| 实发合计 | 实际发放金额 |
| 计算时间 | 工资计算时间 |
| 更新时间 | 记录更新时间 |

### 审计字段 (6个)
| 字段名 | 描述 |
|--------|------|
| 审计状态 | 审计状态 |
| 审计时间 | 审计时间 |
| 审计员ID | 审计员标识 |
| 审计备注 | 审计备注信息 |
| 版本号 | 记录版本号 |
| 备注 | 其他备注信息 |

## 输出示例

脚本运行后会显示详细统计信息：
```
=== 2025年06月 工资明细统计 ===
周期时间: 2025-05-31 至 2025-06-29
发放日期: 2025-07-04

各人员类别工资分布:
------------------------------------------------------------------------------------------------------------------------
类别             | 人数 | 平均应发   | 平均扣除   | 平均实发   | 应发范围            | 类别应发总额  | 类别实发总额 
------------------------------------------------------------------------------------------------------------------------
公务员           |  32人 |  18562.34 |   5234.56 |  13327.78 | 15000~25000        |   594000.88 |   426488.96
参照公务员管理   |  28人 |  16875.21 |   4876.23 |  11999.98 | 14000~22000        |   472506.88 |   335999.44
事业管理人员     |   8人 |  12456.78 |   3123.45 |   9333.33 | 10000~15000        |    99654.24 |    74666.64
综合类           |  10人 |   7234.56 |   1834.56 |   5400.00 | 6000~9000          |    72345.60 |    54000.00
机关工勤         |   3人 |  14567.89 |   3456.78 |  11111.11 | 13000~16000        |    43703.67 |    33333.33
------------------------------------------------------------------------------------------------------------------------
总计             |  81人 |          |          |          |                    |  1282211.27 |   924488.37

=== 工资明细字段结构分析 ===
总字段数: 120
基本信息字段: 16 个
收入项目字段: 65 个
扣除项目字段: 25 个
其他字段: 14 个

过滤零值字段后，保留 85 个有效字段
成功导出 81 条工资明细记录到: 工资明细_有效字段_2025-06_20250124_143025.csv
```

## 特色功能

### 1. 智能字段过滤
- **默认模式**: 自动过滤在所有员工中都为0的工资项目字段
- **完整模式**: 使用 `--include-zero-fields` 参数导出所有120+字段
- **减少文件大小**: 过滤后通常可减少30-40%的无用字段

### 2. 全面的工资项目覆盖
包含所有类型的工资项目：
- 基础工资类（基本工资、岗位工资、级别工资等）
- 绩效奖金类（各种绩效工资和奖金）
- 津贴补贴类（各种津贴补贴）
- 专业津贴类（教龄、护龄、警衔等专业津贴）
- 扣除项目类（社保、公积金、个税等）

### 3. 详细统计分析
提供多维度统计信息：
- 按人员类别分组的工资分布
- 平均工资水平和范围区间
- 各类别工资总额汇总
- 字段结构分析

### 4. 灵活的导出选项
- 支持字段过滤和完整导出两种模式
- 自定义输出文件名
- 统计信息查看模式
- 字段结构分析功能

## 数据来源说明

脚本使用 `reports.v_comprehensive_employee_payroll_optimized` 视图作为数据源，该视图是：
- 最完整的工资明细数据视图
- 包含所有收入和扣除项目
- 经过性能优化的查询视图
- 结合了员工基本信息和薪资明细

## 注意事项

1. **文件大小**: 完整导出可能产生较大的CSV文件，建议使用默认的字段过滤模式
2. **字段理解**: 工资项目字段众多，建议结合实际业务需要选择关注的字段
3. **数据完整性**: 某些专业津贴只适用于特定人员类别，可能在其他员工中为空
4. **编码格式**: 输出文件使用UTF-8-BOM编码，Excel可正确打开
5. **性能考虑**: 数据量大时查询可能较慢，请耐心等待

## 常见问题

### Q: 导出的文件很大，如何减小？
A: 使用默认模式（不加--include-zero-fields参数），系统会自动过滤无用的全零字段。

### Q: 某些工资项目显示为0是否正常？
A: 正常。不同人员类别适用不同的工资项目，未适用的项目会显示为0。

### Q: 如何理解这么多工资项目？
A: 可以使用--analyze-fields参数查看字段分类，或参考本文档的字段说明。

### Q: 单位缴费项目是做什么用的？
A: 单位缴费项目用于成本核算和财务统计，不影响员工实际到手工资。

### Q: 导出数据与工资条不一致怎么办？
A: 请检查薪资周期是否正确，或联系系统管理员确认数据计算状态。