# 员工缴费基数导出脚本使用说明

## 功能描述
该脚本用于导出指定薪资周期的所有员工缴费基数信息到CSV文件，包含社保、住房公积金、职业年金等各类缴费基数及费率信息。

## 安装依赖
```bash
pip install psycopg2-binary
```

## 使用方法

### 1. 基本用法
```bash
# 导出2025年6月的缴费基数信息
python export_contribution_base.py 2025-06
```

### 2. 指定输出文件
```bash
# 自定义输出文件名
python export_contribution_base.py 2025-06 --output 缴费基数_202506.csv
```

### 3. 仅查看统计信息
```bash
# 只显示统计信息，不导出文件
python export_contribution_base.py 2025-06 --stats-only
```

### 4. 查看帮助
```bash
python export_contribution_base.py --help
```

## 输出文件包含字段

### 基本信息
| 字段名 | 描述 |
|--------|------|
| 薪资周期 | 薪资发放周期名称 |
| 周期开始日期 | 薪资周期开始日期 |
| 周期结束日期 | 薪资周期结束日期 |
| 发放日期 | 薪资发放日期 |
| 员工编号 | 员工工号 |
| 员工姓名 | 员工姓名 |
| 身份证号 | 员工身份证号码 |
| 人员类别 | 身份类别（如：公务员、事业管理人员等） |
| 部门名称 | 所属部门 |
| 职位名称 | 职位名称 |
| 入职日期 | 入职时间 |
| 员工状态 | 在职/离职状态 |

### 缴费基数信息
| 字段名 | 描述 |
|--------|------|
| 社保缴费基数 | 社会保险总缴费基数 |
| 养老保险缴费基数 | 养老保险专项基数 |
| 医疗保险缴费基数 | 医疗保险专项基数 |
| 住房公积金缴费基数 | 公积金缴费基数 |
| 职业年金缴费基数 | 职业年金缴费基数 |
| 个人所得税计税基数 | 个税计算基数 |
| 基本工资 | 员工基本工资标准 |

### 缴费费率信息
| 字段名 | 描述 |
|--------|------|
| 养老保险个人费率 | 个人承担的养老保险费率(%) |
| 医疗保险个人费率 | 个人承担的医疗保险费率(%) |
| 住房公积金个人费率 | 个人承担的公积金费率(%) |
| 养老保险单位费率 | 单位承担的养老保险费率(%) |
| 医疗保险单位费率 | 单位承担的医疗保险费率(%) |
| 住房公积金单位费率 | 单位承担的公积金费率(%) |

### 计算缴费金额
| 字段名 | 描述 |
|--------|------|
| 养老保险个人缴费 | 个人实际缴费金额 |
| 医疗保险个人缴费 | 个人实际缴费金额 |
| 住房公积金个人缴费 | 个人实际缴费金额 |
| 养老保险单位缴费 | 单位实际缴费金额 |
| 医疗保险单位缴费 | 单位实际缴费金额 |
| 住房公积金单位缴费 | 单位实际缴费金额 |

### 薪资汇总信息
| 字段名 | 描述 |
|--------|------|
| 应发合计 | 应发工资总额 |
| 扣除合计 | 扣除金额总计 |
| 实发合计 | 实际发放金额 |
| 计算时间 | 薪资计算时间 |

## 输出示例

脚本运行后会显示详细统计信息：
```
=== 2025年06月 缴费基数统计 ===
周期时间: 2025-05-31 至 2025-06-29
发放日期: 2025-07-04

各人员类别缴费基数情况:
----------------------------------------------------------------------------------------------------
类别             | 人数 | 平均社保基数 | 平均公积金基数 | 平均计税基数 | 社保基数范围        
----------------------------------------------------------------------------------------------------
公务员           |  32人 |  18562.34 |    18562.34 |  18562.34 | 15000~25000        
参照公务员管理   |  28人 |  16875.21 |    16875.21 |  16875.21 | 14000~22000        
事业管理人员     |   8人 |  12456.78 |    12456.78 |  12456.78 | 10000~15000        
综合类           |  10人 |   7234.56 |     7234.56 |   7234.56 | 6000~9000         
机关工勤         |   3人 |  14567.89 |    14567.89 |  14567.89 | 13000~16000       
----------------------------------------------------------------------------------------------------
总计             |  81人

成功导出 81 条员工缴费基数记录到: 员工缴费基数_2025-06_20250124_143025.csv
```

## 特色功能

### 1. 自动计算缴费金额
脚本会根据缴费基数和费率自动计算出个人和单位的实际缴费金额，无需手工计算。

### 2. 全面的基数覆盖
包含所有主要的社会保险和公积金缴费基数：
- 社保统一基数
- 养老保险专项基数
- 医疗保险专项基数
- 住房公积金基数
- 职业年金基数
- 个税计税基数

### 3. 详细统计分析
提供按人员类别分组的统计信息，包括：
- 各类别员工数量分布
- 平均缴费基数水平
- 基数范围区间
- 便于管理层决策参考

### 4. 费率信息完整
不仅提供缴费基数，还包含个人和单位的费率信息，便于核算和审查。

## 数据来源说明

脚本数据主要来源于以下数据库视图和表：
- `reports.v_employees_basic` - 员工基本信息
- `reports.v_payroll_calculations` - 缴费基数和费率计算
- `payroll.payroll_entries` - 薪资条目
- `payroll.payroll_periods` - 薪资周期

## 注意事项

1. 确保网络能够连接到数据库服务器
2. 薪资周期格式必须为 `YYYY-MM`（如：2025-06）
3. 缴费基数数据依赖于薪资计算过程，确保目标周期已完成薪资计算
4. 输出的CSV文件使用UTF-8编码，可以用Excel正确打开
5. 所有金额字段保留2位小数，费率以百分比形式存储

## 常见问题

### Q: 某些员工缴费基数显示为0怎么办？
A: 这可能是因为该员工在该周期没有进行薪资计算，或者缴费基数配置缺失。请检查员工薪资配置。

### Q: 个人和单位缴费金额计算是否准确？
A: 脚本使用基数×费率÷100的公式自动计算，结果保留2位小数。如有疑问可对照原始数据手工验证。

### Q: 为什么职业年金基数可能为空？
A: 职业年金只适用于特定人员类别（如机关事业单位人员），其他类别员工此字段可能为空或0。

### Q: 导出的基数与实际扣款不一致？
A: 缴费基数是计算依据，实际扣款可能还受到其他因素影响（如补缴、调整等）。建议结合薪资明细一并分析。