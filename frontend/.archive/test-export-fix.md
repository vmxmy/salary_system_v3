# è–ªèµ„å¯¼å‡ºä¿®å¤æµ‹è¯•æŒ‡å—

## ğŸ”§ ä¿®å¤å†…å®¹

### 1. ç«‹å³ä¿®å¤ï¼šä½¿ç”¨è§†å›¾ä¸­å·²æœ‰çš„å­—æ®µ
- âœ… ä¿®æ”¹äº†è–ªèµ„æ˜ç»†å¯¼å‡ºé€»è¾‘ï¼Œä½¿ç”¨ `gross_pay`ã€`total_deductions`ã€`net_pay` å­—æ®µ
- âœ… é¿å…äº†ä¸å¯é çš„å­—ç¬¦ä¸²åŒ¹é…è®¡ç®—

### 2. çŸ­æœŸä¼˜åŒ–ï¼šåˆ©ç”¨ component_type å­—æ®µæ­£ç¡®åˆ†ç±»
- âœ… ä½¿ç”¨ `component_type` å­—æ®µè¿›è¡Œè–ªèµ„é¡¹ç›®åˆ†ç±»
- âœ… æ”¹è¿›äº†è–ªèµ„é¡¹ç›®æ’åºé€»è¾‘ï¼ˆæ”¶å…¥é¡¹åœ¨å‰ï¼Œæ‰£é™¤é¡¹åœ¨åï¼‰

## ğŸ§ª æµ‹è¯•æ­¥éª¤

### æµ‹è¯•å‰å‡†å¤‡
1. ç¡®ä¿æ•°æ®åº“ä¸­æœ‰è–ªèµ„è®°å½•å’Œè–ªèµ„é¡¹ç›®æ˜ç»†
2. æ•°æ®åº”åŒ…å« `view_payroll_unified` è§†å›¾ä¸­çš„å®Œæ•´å­—æ®µ

### æµ‹è¯•ç”¨ä¾‹ 1ï¼šè–ªèµ„æ˜ç»†å¯¼å‡º
```typescript
// åœ¨è–ªèµ„ç®¡ç†é¡µé¢æˆ–é€šè¿‡ Hook ç›´æ¥æµ‹è¯•
const { exportToExcel } = usePayrollExport();

const testConfig = {
  includeDetails: true,
  selectedDataGroups: ['earnings'],
  filename: 'æµ‹è¯•è–ªèµ„æ˜ç»†å¯¼å‡º.xlsx'
};

await exportToExcel(testConfig);
```

### éªŒè¯ç‚¹
1. **åº”å‘åˆè®¡å‡†ç¡®æ€§**ï¼š
   - å¯¼å‡ºçš„ Excel ä¸­"åº”å‘åˆè®¡"åˆ—åº”ä¸ç³»ç»Ÿæ˜¾ç¤ºçš„ gross_pay å®Œå…¨ä¸€è‡´
   - ä¸åº”å†å‡ºç°è®¡ç®—åå·®

2. **æ‰£æ¬¾åˆè®¡å‡†ç¡®æ€§**ï¼š
   - "æ‰£æ¬¾åˆè®¡"åˆ—åº”ä¸ç³»ç»Ÿçš„ total_deductions ä¸€è‡´

3. **å®å‘å·¥èµ„å‡†ç¡®æ€§**ï¼š
   - "å®å‘å·¥èµ„"åˆ—åº”ä¸ç³»ç»Ÿçš„ net_pay ä¸€è‡´

4. **è–ªèµ„é¡¹ç›®åˆ†ç±»**ï¼š
   - æ”¶å…¥é¡¹ç›®ï¼ˆå¦‚åŸºæœ¬å·¥èµ„ã€æ´¥è´´ç­‰ï¼‰åº”æ’åœ¨å‰é¢
   - æ‰£é™¤é¡¹ç›®ï¼ˆå¦‚ç¤¾ä¿ã€ä¸ªç¨ç­‰ï¼‰åº”æ’åœ¨åé¢

## ğŸ” é—®é¢˜å¯¹æ¯”

### ä¿®å¤å‰çš„é—®é¢˜
```typescript
// âŒ ä½¿ç”¨ä¸å¯é çš„å­—ç¬¦ä¸²åŒ¹é…
const totalIncome = sortedComponents
  .filter(name => !name.includes('æ‰£') && !name.includes('ä¸ªç¨'))
  .reduce((sum, name) => sum + (item.components[name] || 0), 0);
```

### ä¿®å¤åçš„è§£å†³æ–¹æ¡ˆ
```typescript
// âœ… ç›´æ¥ä½¿ç”¨æ•°æ®åº“è®¡ç®—çš„å‡†ç¡®å€¼
row['åº”å‘åˆè®¡'] = item.gross_pay;  // ä»è§†å›¾è·å–
row['æ‰£æ¬¾åˆè®¡'] = item.total_deductions;  // ä»è§†å›¾è·å–
row['å®å‘å·¥èµ„'] = item.net_pay;  // ä»è§†å›¾è·å–

// âœ… ä½¿ç”¨ component_type æ­£ç¡®åˆ†ç±»
if (item.component_type === 'earning' || item.component_type === 'income') {
  employeeData.incomeComponents[item.component_name] = item.item_amount || 0;
} else if (item.component_type === 'deduction') {
  employeeData.deductionComponents[item.component_name] = Math.abs(item.item_amount || 0);
}
```

## ğŸ“Š é¢„æœŸæ•ˆæœ

1. **æ•°æ®ä¸€è‡´æ€§**ï¼šå¯¼å‡ºçš„é‡‘é¢ä¸ç³»ç»Ÿå…¶ä»–åœ°æ–¹æ˜¾ç¤ºå®Œå…¨ä¸€è‡´
2. **æ€§èƒ½æå‡**ï¼šä¸éœ€è¦é‡æ–°è®¡ç®—ï¼Œç›´æ¥ä½¿ç”¨æ•°æ®åº“é¢„è®¡ç®—å€¼
3. **å¯ç»´æŠ¤æ€§**ï¼šä¸ä¾èµ–è–ªèµ„é¡¹ç›®çš„å‘½åè§„èŒƒï¼Œä½¿ç”¨æ ‡å‡†åŒ–çš„ç±»å‹å­—æ®µ
4. **å‡†ç¡®æ€§**ï¼šæ¶ˆé™¤å› å­—ç¬¦ä¸²åŒ¹é…å¯¼è‡´çš„åˆ†ç±»é”™è¯¯

## ğŸš€ åç»­æ”¹è¿›å»ºè®®

1. **æ·»åŠ éªŒè¯æœºåˆ¶**ï¼šå¯ä»¥åœ¨å¼€å‘ç¯å¢ƒä¸­å¯ç”¨è®¡ç®—éªŒè¯ï¼Œç¡®ä¿æ•°æ®åº“å€¼ä¸é‡æ–°è®¡ç®—å€¼ä¸€è‡´
2. **ç¼“å­˜ä¼˜åŒ–**ï¼šå¯¹äºå¤§é‡æ•°æ®çš„å¯¼å‡ºï¼Œå¯ä»¥è€ƒè™‘åˆ†æ‰¹å¤„ç†
3. **é”™è¯¯å¤„ç†**ï¼šå¢åŠ å¯¹ç¼ºå¤±å­—æ®µçš„å¤„ç†å’Œç”¨æˆ·æç¤º
