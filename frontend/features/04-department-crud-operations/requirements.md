# 部门CRUD操作

## 功能概述
实现部门的增删改查功能，使用孔雀屏设计模式的模态框进行操作，确保用户体验的一致性。

## 核心需求
- ✅ 创建部门（支持选择上级部门）
- ✅ 编辑部门信息（使用孔雀屏模态框）
- ✅ 删除部门（处理子部门逻辑）
- ✅ 查看部门详情（孔雀屏展示）
- ✅ 数据验证和错误处理

## 主要功能点
1. ✅ 部门详情模态框（DepartmentDetailModal）
2. ✅ 部门表单组件（内置于模态框）
3. ✅ 上级部门选择器（ParentDepartmentSelect）
4. ✅ 删除确认对话框
5. ✅ 操作成功/失败反馈

## 已实现的功能

### DepartmentDetailModal 部门详情模态框
- **统一风格**: 完全复用员工详情模态框的样式和模块设计
- **三种模式**: 
  - view: 查看部门详情
  - edit: 编辑现有部门
  - create: 创建新部门
- **现代化设计**: 
  - 渐变背景遮罩
  - 玻璃效果边框
  - 微妙光效动画
  - 平滑的打开/关闭动画

### 孔雀屏模块设计
采用与员工详情相同的手风琴式展开设计，包含以下模块：

#### 1. 基本信息孔雀屏
- **部门名称**: 必填字段，支持实时验证
- **上级部门**: 下拉选择，自动排除自身避免循环引用
- **部门主管**: 员工选择器（预留接口）
- **排序顺序**: 数字输入，控制显示顺序
- **部门描述**: 多行文本，支持详细说明

#### 2. 层级关系孔雀屏
- **部门层级**: 显示当前层级深度
- **完整路径**: 显示从根部门到当前部门的完整路径
- **子部门信息**: 显示子部门数量和列表预览

#### 3. 部门员工孔雀屏
- **员工列表**: 展示部门下所有员工
- **员工信息**: 显示姓名、工号、职位、状态
- **分页显示**: 超过10人时显示剩余数量
- **加载状态**: 优雅的加载动画

#### 4. 薪资统计孔雀屏
- **统计期间**: 显示数据对应的年月
- **关键指标**: 
  - 员工人数
  - 平均薪资
  - 薪资总额
  - 实发总额
- **薪资分布图**: 使用 DepartmentSalaryChart 组件
- **占比信息**: 
  - 员工占比（相对于全公司）
  - 薪资占比（相对于全公司）

### 数据管理功能
- **实时验证**: 部门名称必填验证
- **循环引用检测**: 防止部门设置自己为上级
- **状态管理**: 使用 React Query 管理数据状态
- **乐观更新**: 提供即时的用户反馈
- **错误处理**: 优雅的错误提示和恢复机制

### 操作反馈设计
- **Toast 通知**: 成功/失败/信息提示
- **按钮状态**: 
  - 加载中显示旋转动画
  - 禁用状态视觉反馈
- **模态框底部布局**:
  - 左侧：删除按钮（编辑模式下）
  - 右侧：取消/关闭、保存/创建、编辑切换

### 技术实现特色
- **TypeScript 类型安全**: 完整的类型定义
- **React Query 集成**: 
  - 数据获取和缓存
  - 乐观更新
  - 自动重新获取
- **响应式设计**: 适配各种屏幕尺寸
- **键盘快捷键**: ESC 键关闭模态框
- **防止背景滚动**: 模态框打开时锁定背景

### 与其他组件的集成
- **DepartmentTree**: 树形视图中的操作菜单可打开详情模态框
- **DepartmentCard**: 卡片视图中的操作菜单可打开详情模态框
- **父部门选择**: 自动加载部门树数据用于选择
- **员工数据**: 自动加载部门员工列表
- **薪资统计**: 自动加载最新的薪资统计数据

## 下一步
部门CRUD操作已完成，可以继续实现第五个功能：**高级搜索与过滤**。