
-- 准备一个临时表来存储职位历史数据
CREATE TEMPORARY TABLE temp_job_history_import (
    old_employee_id BIGINT,
    old_department_id BIGINT,
    old_position_id BIGINT,
    effective_date DATE,
    end_date DATE
);

-- 插入从原系统查询到的数据
INSERT INTO temp_job_history_import (old_employee_id, old_department_id, old_position_id, effective_date, end_date) VALUES
(303, 82, 1, '2008-12-01', NULL),
(304, 83, 2, '2018-01-29', NULL),
(305, 84, 3, '2005-06-01', NULL),
(306, 85, 3, '2013-08-01', NULL),
(307, 82, 4, '2020-12-01', NULL),
(308, 86, 5, '2020-03-14', NULL),
(309, 86, 6, '2019-03-01', NULL),
(310, 86, 7, '2021-09-01', NULL),
(311, 86, 9, '2024-07-05', NULL),
(312, 82, 10, '2014-10-01', NULL),
(313, 84, 11, '2017-07-28', NULL),
(314, 87, 3, '2006-09-01', NULL),
(315, 87, 3, '2005-07-01', NULL),
(316, 83, 3, '2008-07-01', NULL),
(317, 88, 12, '2011-07-01', NULL),
(318, 85, 3, '2011-08-01', NULL),
(319, 87, 11, '2022-09-29', NULL),
(320, 88, 11, '2023-06-14', NULL),
(321, 87, 3, '2023-10-31', NULL),
(322, 85, 3, '2023-08-30', NULL),
(323, 88, 13, '2023-05-12', NULL),
(324, 85, 14, '2017-12-15', NULL),
(325, 86, 15, '2024-07-05', NULL),
(326, 85, 16, '2024-07-20', NULL),
(327, 88, 17, '2024-07-14', NULL),
(328, 89, 16, '2025-01-21', NULL),
(329, 89, 16, '2021-07-31', NULL),
(330, 88, 13, '2024-12-17', NULL),
(331, 90, 13, '2024-12-17', NULL),
(332, 90, 18, '2023-11-01', NULL),
(333, 89, 19, '2024-03-23', NULL),
(334, 91, 20, '2022-07-29', NULL),
(335, 89, 3, '2022-11-28', NULL),
(336, 89, 13, '2024-07-24', NULL),
(338, 89, 3, '2023-10-01', NULL),
(339, 85, 26, '2024-11-15', NULL),
(340, 87, 23, '2023-06-14', NULL),
(341, 84, 24, '2019-07-01', NULL),
(342, 88, 22, '2020-12-01', NULL),
(343, 88, 25, '2022-07-20', NULL),
(344, 83, 25, '2024-07-14', NULL),
(345, 87, 25, '2024-07-14', NULL),
(346, 84, 20, '2024-07-12', NULL),
(347, 90, 25, '2024-07-13', NULL),
(348, 89, 23, '2025-03-13', NULL),
(349, 90, 25, '2022-07-20', NULL),
(350, 91, 22, '2024-03-01', NULL),
(351, 91, 24, '2021-07-01', NULL),
(352, 90, 23, '2024-03-01', NULL),
(337, 82, 3, '2025-02-27', '2025-05-23'),
(337, 82, 24, '2025-05-23', NULL),
(353, 86, 36, '2023-04-28', NULL),
(354, 82, 27, '2017-06-01', NULL),
(355, 82, 27, '2024-04-01', NULL),
(356, 82, 27, '2017-06-01', NULL),
(357, 85, 34, '2023-01-01', NULL),
(358, 87, 33, '2023-01-01', NULL),
(359, 83, 34, '2017-06-01', NULL),
(360, 87, 27, '2017-06-01', NULL),
(361, 82, 34, '2023-01-01', NULL),
(362, 84, 32, '2023-11-23', NULL),
(363, 82, 32, '2024-01-01', NULL),
(364, 88, 32, '2025-04-28', NULL),
(365, 90, 33, '2017-06-01', NULL),
(366, 90, 32, '2017-06-01', NULL),
(367, 91, 32, '2017-06-01', NULL),
(368, 91, 32, '2023-03-01', NULL),
(369, 90, 32, '2023-03-01', NULL),
(370, 90, 32, '2023-03-01', NULL),
(371, 90, 32, '2023-11-01', NULL),
(372, 88, 31, '2017-06-01', NULL),
(373, 89, 34, '2017-06-01', NULL),
(374, 91, 31, '2017-06-01', NULL),
(375, 83, 31, '2022-03-01', NULL),
(376, 87, 31, '2017-06-01', NULL),
(377, 84, 31, '2017-06-01', NULL),
(378, 85, 27, '2017-06-01', NULL),
(379, 83, 30, '2024-04-01', NULL),
(380, 83, 29, '2024-04-01', NULL),
(381, 83, 29, '2024-04-01', NULL),
(382, 83, 28, '2024-04-01', NULL),
(383, 84, 29, '2024-04-01', NULL),
(390, 83, 3, '2025-06-01', NULL);


-- 插入到新的 employee_job_history 表
INSERT INTO employee_job_history (employee_id, department_id, position_id, start_date, end_date)
SELECT 
    (SELECT new_id FROM migration_employee_id_map WHERE old_id = imp.old_employee_id),
    (SELECT new_id FROM department_id_mapping WHERE old_id = imp.old_department_id),
    (SELECT new_id FROM position_id_mapping WHERE old_id = imp.old_position_id),
    imp.effective_date, 
    imp.end_date
FROM 
    temp_job_history_import AS imp;

-- 删除临时表
DROP TABLE temp_job_history_import;
